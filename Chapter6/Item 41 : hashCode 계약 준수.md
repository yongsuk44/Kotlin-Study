# Item 41: HashCode 계약 준수

`hashCode` 메서드는 `Any`에서 오버라이드 할 수 있는 메서드입니다. 

`hashCode` 함수는 해시 테이블(`HashTable`)이라는 인기 있는 자료구조에서 사용됩니다.
이 해시 테이블은 다양한 컬렉션이나 알고리즘의 내부에서 사용됩니다.

## Hash table

개발자들은 때때로 빠르게 요소를 추가하고 검색할 수 있는 컬렉션이 필요합니다.

이렇게 만들어진 `set` 또는 `map` 같은 컬렉션은 중복을 허용하지 않기 때문에, 요소를 추가할 때마다 그 요소가 이미 존재하는지 확인해야 합니다.

배열(array)이나 연결된 요소(linked elements)를 기반으로 한 컬렉션은 모든 요소와 비교를 해야 하기에 이러한 확인 작업에 빠르지 않습니다.

이 문제를 해결하기 위한 방법 중 하나는 해시 테이블입니다.
해시 테이블 사용 시 해시 함수를 사용하며 해시 함수는 각 요소에 대해 숫자를 할당하는 역할을 합니다. 

개발자들은 해시 함수에 다음과 같은 특징을 기대하고 사용합니다.

### 1. 빠른 동작

해시 함수는 빠르게 동작해야 합니다.   
해시 테이블과 같은 자료 구조는 해시 함수를 사용하여 데이터를 빠르게 추가하고 검색하기 때문에 빠른 해시 함수는 성능을 향상시키는 데 중요합니다. 
또한 해시 함수가 빠르면 데이터 구조 전반의 성능에도 긍정적인 영향을 미칩니다.

### 2. 동등한 요소에 대해 동일한 해시 코드 반환

동일한 입력 데이터는 항상 동일한 해시 코드로 변환되어야 합니다.   
이는 해시 테이블의 동작에 중요한 영향을 미치는 요소입니다. 
만약 같은 데이터에 대해 서로 다른 해시 코드가 반환되면 해당 데이터를 찾거나 제거하는 과정에서 문제가 발생할 수 있습니다.

### 3. 서로 다른 요소에 대해 다른 해시 코드 반환 또는 충돌 최소화

이상적으로, 서로 다른 입력 데이터는 서로 다른 해시 코드로 변환되어야 합니다.  
만약 서로 다른 데이터에 대해 같은 해시 코드가 반환되면 충돌이 발생하고, 이는 해시 테이블 성능을 저하시킬 수 있습니다. 
따라서 해시 함수는 데이터가 고르게 분산되도록 설계되어야 합니다.

### 해시 함수

해시 함수는 각 요소를 다른 버킷(`bucket`)으로 분류하며, 이 때 각 요소에 번호를 할당합니다.

해시 함수가 올바르게 작동한다면, 동일한 요소는 항상 동일한 버킷에 들어갈 것입니다.
이러한 버킷은 해시 테이블 구조에서 관리되며 해시 테이블은 버킷 수와 동일한 크기의 배열이 됩니다.

요소 추가 시, 해시 함수를 사용해 그 요소가 어느 버킷에 들어가야 할지 계산하고 그 버킷에 요소를 추가합니다.
이는 매우 빠르게 처리되며, 해시 값을 계산한 후 그 값을 배열의 인덱스로 사용해 버킷을 찾을 수 있습니다. 

요소 검색 시, 다른 버킷을 확인 할 필요 없이 해당 버킷을 찾고 그 안에서 해당 요소를 찾으면 됩니다.
왜냐하면 해시 함수는 동일한 요소에 대해 항상 동일한 값을 반환하기 때문입니다.

요소의 수를 버킷의 수로 나눠서 소수의 요소만을 확인해 요소를 찾을 수 있습니다.
예를 들어 1M 요소와 1K 버킷이 있다면 중복 검색을 위해 평균적으로 1K 요소를 비교해야 합니다. 
이렇게 해서 성능을 크게 향상시킬 수 있습니다.

아래 표는 문자열에 대한 해시 함수가 4개의 버킷으로 문자열을 분류하는 경우를 보여줍니다.

| Text                                           | Hash code |
|------------------------------------------------|-----------|
| "How much wood would a woodchuck chuck"        | 3         |
| "Peter Piper picked a peck of pcikled peppers" | 2         |
| "Betty bought a bit of butter"                 | 1         |
| "She sells seashells by the seashore"          | 2         |

해시 코드에 따라 다음과 같은 해시 테이블로 구성됩니다.

| Index | Object to which hash table points                                                       | 
|-------|-----------------------------------------------------------------------------------------|
| 0     | []                                                                                      |
| 1     | ["Betty bought a bit of butter"]                                                        |
| 2     | ["Peter Piper picked a peck of pcikled peppers", "She sells seashells by the seashore"] |
| 3     | ["How much wood would a woodchuck chuck"]                                               |

새로운 텍스트가 이 해시 테이블에 있는지 확인하려면, 해당 텍스트의 해시 코드를 계산하며 다음과 같은 경우의 수를 가질 수 있습니다.

- 해시 코드가 0인 경우, 그 텍스트는 리스트에 없다는 것을 바로 알 수 있음
- 해시 코드가 1 또는 3인 경우, 그 텍스트를 한 개의 텍스트와 비교
- 해시 코드가 2인 경우, 두 개의 텍스트와 비교

이러한 해시 테이블은 데이터베이스, 여러 인터넷 프로토콜, 많은 언어의 표준 라이브러리 컬렉션에서 사용되고 있씁니다.
Kotlin/JVM에서는 기본적으로 제공되는 `set(LinkedHashSet)`과 `map(LinkedHashMap)`이 해시 테이블을 사용합니다.
해시 코드를 생성하기 위해서는 `hashCode()`를 사용하면 됩니다.